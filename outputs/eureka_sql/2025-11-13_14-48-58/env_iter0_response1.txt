Gym has been unmaintained since 2022 and does not support NumPy 2.0 amongst other critical functionality.
Please upgrade to Gymnasium, the maintained drop-in replacement of Gym, or contact the authors of your software and request that they upgrade.
Users of this version of Gym should be able to simply replace 'import gym' with 'import gymnasium as gym' in the vast majority of cases.
See the migration guide at https://gymnasium.farama.org/introduction/migration_guide/ for additional information.
Loading dataset example_text2sql_spider_train.json...
Checksum failed: missing SHA-1 hash value in dataset_info.json.
trainable params: 247536384 || all params: 247536384 || trainable%: 100.0000
/opt/conda/envs/sql-rl-gen/lib/python3.10/site-packages/textrl/environment.py:89: FutureWarning: `torch.cuda.amp.autocast(args...)` is deprecated. Please use `torch.amp.autocast('cuda', args...)` instead.
  with torch.cuda.amp.autocast(enabled=False):
Reward: 0.0, Metrics: {'accuracy': 0.0, 'precision': 0.0, 'recall': 0.0, 'f1': 0.0, 'iou': 0.0, 'error_type': <class 'sqlite3.OperationalError'>, 'error_reason': 'no such column: T1.Year'}
['SELECT T1.Year, T1.Official_Name FROM city AS T1 JOIN farm_competition AS T2 ON T1.City_ID = T2.Host_city_ID</s>']
------------TRAINING IS STARTED------------
Reward: 0.0, Metrics: {'accuracy': 0.0, 'precision': 0.0, 'recall': 0.0, 'f1': 0.0, 'iou': 0.0, 'error_type': <class 'sqlite3.OperationalError'>, 'error_reason': 'no such column: T2.born_state'}
Reward: 0.0, Metrics: {'accuracy': 0.0, 'precision': 0.0, 'recall': 0.0, 'f1': 0.0, 'iou': 0.0, 'error_type': <class 'sqlite3.OperationalError'>, 'error_reason': 'no such table: secretary'}
Reward: 0.0, Metrics: {'accuracy': 0.0, 'precision': 0.0, 'recall': 0.0, 'f1': 0.0, 'iou': 0.0, 'error_type': <class 'sqlite3.OperationalError'>, 'error_reason': 'no such table: staff'}
Reward: 0.0, Metrics: {'accuracy': 0.0, 'precision': 0.0, 'recall': 0.0, 'f1': 0.0, 'iou': 0.0, 'error_type': <class 'sqlite3.OperationalError'>, 'error_reason': 'no such column: T2.born_state'}
Reward: 0.0, Metrics: {'accuracy': 0.0, 'precision': 0.0, 'recall': 0.0, 'f1': 0.0, 'iou': 0.0, 'error_type': <class 'sqlite3.OperationalError'>, 'error_reason': 'no such table: staff'}
Reward: 0.0, Metrics: {'accuracy': 1.0, 'precision': 1.0, 'recall': 1.0, 'f1': 1.0, 'iou': 1.0, 'error_type': None, 'error_reason': None}
Reward: 0.0, Metrics: {'accuracy': 1.0, 'precision': 1.0, 'recall': 1.0, 'f1': 1.0, 'iou': 1.0, 'error_type': None, 'error_reason': None}
Reward: 0.0, Metrics: {'accuracy': 0.0, 'precision': 0.0, 'recall': 0.0, 'f1': 0.0, 'iou': 0.0, 'error_type': <class 'sqlite3.OperationalError'>, 'error_reason': 'no such column: T1.head_id'}
Reward: 0.0, Metrics: {'accuracy': 0.0, 'precision': 0.0, 'recall': 0.0, 'f1': 0.0, 'iou': 0.0, 'error_type': <class 'sqlite3.OperationalError'>, 'error_reason': 'no such column: T2.born_state'}
Reward: 0.0, Metrics: {'accuracy': 0.0, 'precision': 0.0, 'recall': 0.0, 'f1': 0.0, 'iou': 0.0, 'error_type': <class 'sqlite3.OperationalError'>, 'error_reason': 'no such column: T3.born_state'}
Saved the agent to 0_1/0_except
Traceback (most recent call last):
  File "/root/repos/sql-rl-gen/sql_rl_gen/generation/sql_generation.py", line 51, in <module>
    run()
  File "/root/repos/sql-rl-gen/sql_rl_gen/generation/sql_generation.py", line 48, in run
    train_llm(train_args, data_args)
  File "/root/repos/sql-rl-gen/sql_rl_gen/generation/sql_generation.py", line 40, in train_llm
    train_evaulate_agent(agent, env, steps=train_args.steps_n, eval_n_steps=None, eval_n_episodes=train_args.eval_n_episodes, train_max_episode_len=train_args.train_max_episode_len,
  File "/root/repos/sql-rl-gen/sql_rl_gen/generation/rllib/custom_trainer.py", line 20, in train_evaulate_agent
    eval_stats_history = train_agent(agent, env, steps, outdir, checkpoint_freq=checkpoint_freq, max_episode_len=train_max_episode_len, step_offset=step_offset, evaluator=evaluator,
  File "/root/repos/sql-rl-gen/sql_rl_gen/generation/rllib/custom_trainer.py", line 67, in train_agent
    obs, r, done, info = env.step(action)
  File "/opt/conda/envs/sql-rl-gen/lib/python3.10/site-packages/textrl/environment.py", line 39, in step
    reward = self.get_reward(self.input_item, predicted, finish)
  File "/root/repos/sql-rl-gen/sql_rl_gen/generation/envs/sql_generation_environment.py", line 52, in get_reward
    reward, metrics = self.compute_reward(input_item, predicted_text)
  File "/root/repos/sql-rl-gen/sql_rl_gen/generation/envs/sql_generation_environment.py", line 64, in compute_reward
    return compute_reward(self, input_item, predicted_text)
  File "/root/repos/sql-rl-gen/sql_rl_gen/generation/envs/sql_generation_environment.py", line 116, in compute_reward
    error_reason = feedback_dict["error_reason"]
KeyError: 'error_reason'
